(()=>{function d(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var o in t)s[o]=t[o]}return s}var y={read:function(s){return s[0]==='"'&&(s=s.slice(1,-1)),s.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(s){return encodeURIComponent(s).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function h(s,e){function t(r,n,i){if(!(typeof document>"u")){i=d({},e,i),typeof i.expires=="number"&&(i.expires=new Date(Date.now()+i.expires*864e5)),i.expires&&(i.expires=i.expires.toUTCString()),r=encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var c in i)i[c]&&(a+="; "+c,i[c]!==!0&&(a+="="+i[c].split(";")[0]));return document.cookie=r+"="+s.write(n,r)+a}}function o(r){if(!(typeof document>"u"||arguments.length&&!r)){for(var n=document.cookie?document.cookie.split("; "):[],i={},a=0;a<n.length;a++){var c=n[a].split("="),S=c.slice(1).join("=");try{var u=decodeURIComponent(c[0]);if(i[u]=s.read(S,u),r===u)break}catch{}}return r?i[r]:i}}return Object.create({set:t,get:o,remove:function(r,n){t(r,"",d({},n,{expires:-1}))},withAttributes:function(r){return h(this.converter,d({},this.attributes,r))},withConverter:function(r){return h(d({},this.converter,r),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(s)}})}var g=h(y,{path:"/"});var l=class{set(s,e){g.set(s,JSON.stringify(e),{secure:!0,sameSite:"None",...this.cookie})}get(s){try{return JSON.parse(g.get(s))}catch{return null}}remove(s){g.remove(s,this.cookie)}clear(){this.remove("rg.session")}set session(s){this.set("rg.session",s)}get session(){return this.get("rg.session")}};var P=(s,e)=>{let t=new URLSearchParams(s.search.substring(1));Object.keys(e).forEach(o=>t.set(o,e[o])),s.search=t.toString()},w=addSessionIdToCrossDomainLinks=(s,e)=>{s.filter(t=>t!==window.location.hostname).forEach(t=>{document.querySelectorAll(`a[href*="${t}"]`).forEach(o=>{P(o,{"revgems-session-id":e})})})};var x={endpoint:"https://t.revgems.com/events",testMode:!1,debug:!1,domains:[]},f=class{constructor(e){this._config={...x,...e,storage:new l},this.log("Running in debug mode..."),this.log("Instantiated",{...this._config,visitorId:this.visitorId})}loadSession(e){this._loadedSessionId=e}get apiKey(){return this._config.apiKey}get endpoint(){return this._config.endpoint}get sessionId(){return this._config.storage.session&&this._config.storage.session.id}get visitorId(){return this._config.storage.session&&this._config.storage.session.visitor_id}get testMode(){return this._config.testMode}get debug(){return this._config.debug}log(){this.debug&&console.debug("[RevGems]",...arguments)}createCrossDomainLinks(){w(this._config.domains,this.sessionId)}ready(e){typeof e=="function"&&(this.log("Executing ready() handler"),e())}attachToForm(e){let t=e.dataset.revgemsInputName||"revgems_visitor_id";e.elements[t]&&e.elements[t].remove();let o=this.visitorId;if(!o)return;let r=document.createElement("input");r.name=t,r.type="hidden",r.dataset.revgemsVisitorId=r.value=o,e.appendChild(r)}attachToForms(){document.querySelectorAll("form[data-revgems]").forEach(e=>this.attachToForm(e))}trackEvent(e,t){let o=this._loadedSessionId||this.sessionId;return this._loadedSessionId=!1,fetch(this.endpoint,{method:"POST",keepalive:!0,headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:this.apiKey,session_id:o,event_type:e,attributes:{url:document.location.toString(),...t},...this.testMode?{test_mode:this.testMode}:{}})}).then(r=>new Promise((n,i)=>{r.json().then(a=>{r.ok?(this.log(`Track ${e} succeeded`,a),n(a)):(this.log(`Track ${e} failed`,a),i(a))}).catch(()=>{i({message:`Invalid JSON response (${r.status})`})})}))}lead(e){return e&&e.id&&console.warn("[RevGems] Passing `id` to `lead()` is deprecated. Please pass `user_id` instead."),this.trackEvent("lead",e)}pageView(e){return e=e||{},this.trackEvent("page_view",{title:e.title||document.title,url:e.url||document.location.href,referrer_url:e.referrer||document.referrer,timestamp:e.timestamp||new Date().getTime(),...e.metadata?{metadata:e.metadata}:{}}).then(t=>{this._config.storage.cookie=t.cookie,this._config.storage.session=t.session,this.attachToForms(),this.createCrossDomainLinks()},t=>{console.error(`Error tracking page view: ${t.message}`)})}scriptLoad(e){return this.pageView(e)}resetSession(){this._config.storage.clear()}},v=f;var _=getApiKey=s=>{let e=s.src;e.startsWith("//")&&(e=`https:${e}`);let t=new URL(e);return s.dataset.apiKey||t.searchParams.get("api-key")};var I=flushQueue=s=>{let e=window[window._rg].q||JSON.parse(window.localStorage.getItem(window._rg)||"[]"),t,o=(n,i)=>s[n](i);m.markPreviousPagePersistedEvents(e),p.ensureFirstPageView(e,o);function r(){for(;e.length;)t=e.shift(),o(t[0],t[1])}firstPageViewIndex=e.findIndex(n=>n[0]==="pageView"||n[0]==="scriptLoad"),firstPageViewIndex!==-1?(t=e.splice(firstPageViewIndex,1)[0],o(t[0],t[1]).then(()=>{r()})):r(),window.localStorage.setItem(window._rg,"[]"),window[window._rg]=o},m=class{static markPreviousPagePersistedEvents(e){let t=e.findLastIndex(o=>o[0]==="scriptLoad");for(let o=0;o<t;o++)this.tryAnnotateParams(e[o]);return e}static tryAnnotateParams(e){let t=e[1];t&&typeof t=="object"&&(t.metadata={captured_from_local_storage:!0})}},p=class{static ensureFirstPageView(e,t){e.some(r=>r[0]==="scriptLoad")||e.unshift(["pageView",{title:document.title,referrer_url:document.referrer,url:window.location.href,timestamp:new Date().getTime()}])}};(function(){if(window._revgemsLoaded){console.warn("RevGems is already loaded. Ensure the script tag appears on the page only once.");return}let s=_(document.currentScript);if(!s){console.error("Missing or invalid RevGems API Key.");return}let e=window.REVGEMS_CONFIG||{},t=new URLSearchParams(window.location.search);t.has("revgems-debug")&&(e.debug=!0);let o=new v({...e,apiKey:s});t.has("revgems-session-id")&&o.loadSession(t.get("revgems-session-id")),window._revgemsLoaded=!0,window.RevGems=o,I(o)})();})();
